/*
 * Nextflow configuration file for Phosphorylation Data Analysis Pipeline
 */

// Global configuration
manifest {
    name = 'Phosphorylation Analysis Pipeline'
    description = 'A Nextflow pipeline for processing phosphorylation site data'
    version = '1.0.0'
    author = 'Sofie Hooft Toomey'
}

// Process configuration
process {
    // Default executor
    executor = 'local'
    
    // Error handling
    errorStrategy = 'terminate'
    maxRetries = 2
    
    // Resource limits
    withLabel: 'blast_db_creation' {
        cpus = 2
        memory = '4 GB'
        time = '2h'
    }
    
    withLabel: 'data_cleaning' {
        cpus = 1
        memory = '2 GB'
        time = '1h'
    }
    
    withLabel: 'blast_analysis' {
        cpus = 4
        memory = '8 GB'
        time = '4h'
    }
    
    withLabel: 'sequence_alignment' {
        cpus = 2
        memory = '4 GB'
        time = '2h'
    }
    
    withLabel: 'visualization' {
        cpus = 2
        memory = '4 GB'
        time = '1h'
    }
    
    // Python environment
    withName: 'CREATE_BLAST_DB|CLEAN_DATA|PAPER_BLAST|TOTAL_BLAST|ALIGN_SEQUENCES|GENERATE_VISUALIZATIONS' {
        container = null  // Use local Python environment
    }
}

// Workflow configuration
workflow {
    onComplete {
        println "Pipeline completed successfully!"
        println "Results are available in: ${params.output_dir}"
    }
    
    onError {
        println "Pipeline failed with error: ${workflow.errorMessage}"
    }
}

// Report configuration
report {
    enabled = true
    file = "${params.output_dir}/pipeline_report.html"
}

// Timeline configuration
timeline {
    enabled = true
    file = "${params.output_dir}/pipeline_timeline.html"
}

// Trace configuration
trace {
    enabled = true
    file = "${params.output_dir}/pipeline_trace.txt"
    fields = 'task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,submit,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar,syscr,syscw,read_bytes,write_bytes,vol_ctxt,inv_ctxt'
}

// DAG configuration
dag {
    enabled = true
    file = "${params.output_dir}/pipeline_dag.svg"
}

// Cleanup configuration
cleanup = true

